image: gitlab-runner/owl

before_script:
  - chmod +x gradlew

stages:
  - build
  - test
  - test-optimizations
  - test-parallel-translation

build:
  stage:
    build
  script:
    - ./gradlew --no-daemon build
  artifacts:
    paths:
    - build/reports/
    when: on_failure
    expire_in: 1 week

.ltlcross: &ltlcross_template
  script:
    - scripts/dist.sh
    - LD_LIBRARY_PATH=$LD_LIBRARY_PATH:$(pwd)/src/main/resources python3 scripts/tests.py $TEST_NAME
  artifacts:
    paths:
    - build/results/
    when: always
    expire_in: 1 week
  dependencies: []

# LTL to LDBA Translations

## Breakpoint

test:ltl2ldba Büchi:
  stage: test-optimizations
  variables:
    TEST_NAME: "ltl2ldba"
  <<: *ltlcross_template

test:ltl2ldba Büchi Non-Det:
  stage: test-optimizations
  variables:
    TEST_NAME: "ltl2ldba-nondet"
  <<: *ltlcross_template

test:ltl2ldba Büchi Vanilla:
  stage: test
  variables:
    TEST_NAME: "ltl2ldba-vanilla"
  <<: *ltlcross_template

test:ltl2ldba generalised-Büchi:
  stage: test-optimizations
  variables:
    TEST_NAME: "ltl2ldba-genb"
  <<: *ltlcross_template

test:ltl2ldba generalised-Büchi Non-Det:
  stage: test-optimizations
  variables:
    TEST_NAME: "ltl2ldba-genb-nondet"
  <<: *ltlcross_template

test:ltl2ldba generalised-Büchi Vanilla:
  stage: test
  variables:
    TEST_NAME: "ltl2ldba-genb-vanilla"
  <<: *ltlcross_template

## Breakpoint-Free

test:ltl2ldba Büchi Breakpoint-Free:
  stage: test-optimizations
  variables:
    TEST_NAME: "ltl2ldba-bpfree"
  <<: *ltlcross_template

test:ltl2ldba Büchi Breakpoint-Free Non-Det:
  stage: test-optimizations
  variables:
    TEST_NAME: "ltl2ldba-bpfree-nondet"
  <<: *ltlcross_template

test:ltl2ldba Büchi Breakpoint-Free Vanilla:
  stage: test
  variables:
    TEST_NAME: "ltl2ldba-bpfree-vanilla"
  <<: *ltlcross_template

test:ltl2ldba generalised-Büchi Breakpoint-Free:
  stage: test-optimizations
  variables:
    TEST_NAME: "ltl2ldba-genb-bpfree"
  <<: *ltlcross_template

test:ltl2ldba generalised-Büchi Breakpoint-Free Non-Det:
  stage: test-optimizations
  variables:
    TEST_NAME: "ltl2ldba-genb-bpfree-nondet"
  <<: *ltlcross_template

test:ltl2ldba generalised-Büchi Breakpoint-Free Vanilla:
  stage: test
  variables:
    TEST_NAME: "ltl2ldba-genb-bpfree-vanilla"
  <<: *ltlcross_template

# NBA to LDBA translations

test:nba2ldba:
  stage: test
  variables:
    TEST_NAME: "nba2ldba"
  <<: *ltlcross_template

# LTL to DPA translations

test:ltl2dpa:
  stage: test-optimizations
  variables:
    TEST_NAME: "ltl2dpa"
  <<: *ltlcross_template

test:ltl2dpa Vanilla:
  stage: test
  variables:
    TEST_NAME: "ltl2dpa-vanilla"
  <<: *ltlcross_template

test-parallel:ltl2dpa Parallel:
  stage: test-parallel-translation
  variables:
    TEST_NAME: "ltl2dpa-parallel"
  <<: *ltlcross_template

# LTL to D*A translations

test-parallel:ltl2det-parallel:
  stage: test-parallel-translation
  variables:
    TEST_NAME: "ltl2da-parallel"
  <<: *ltlcross_template

# FGX to DGA translations

test:fgx2dga Strict:
  stage: test
  variables:
    TEST_NAME: "fgx2da-strict"
  <<: *ltlcross_template

test:fgx2dga Vanilla:
  stage: test
  variables:
    TEST_NAME: "fgx2dga-vanilla"
  <<: *ltlcross_template

test:fgx2dga:
  stage: test-optimizations
  variables:
    TEST_NAME: "fgx2dga"
  <<: *ltlcross_template