image: gitlab-runner/owl

before_script:
  - chmod +x gradlew

stages:
  - build
  - test
  - bench

build:
  stage:
    build
  script:
    - ./gradlew --no-daemon build
  artifacts:
    paths:
    - build/reports/
    when: on_failure
    expire_in: 1 week

.ltlcross: &ltlcross_template
  script:
    - ./gradlew --no-daemon buildBin ltl2autExecutable
    - python3 scripts/util.py test $TEST_NAME
  artifacts:
    paths:
    - build/results/
    when: always
    expire_in: 1 week
  dependencies: []

.benchmark: &benchmark_template
  stage: bench
  script:
    - python3 scripts/util.py bench $BENCH_NAME | tee benchmark.txt
  artifacts:
    paths:
    - benchmark.txt
    when: always
    expire_in: 1 week
  when: manual
  dependencies: []

# LTL to LDBA Translations

ltl2ldba:
  stage: test
  variables:
    TEST_NAME: "ltl2ldba"
  <<: *ltlcross_template

ltl2ldbga:
  stage: test
  variables:
    TEST_NAME: "ltl2ldbga"
  <<: *ltlcross_template

# NBA to LDBA translations

nba2ldba:
  stage: test
  variables:
    TEST_NAME: "nba2ldba"
  <<: *ltlcross_template

# NBA to LDBA translations

nba2dpa:
  stage: test
  variables:
    TEST_NAME: "nba2dpa"
  <<: *ltlcross_template

# LTL to DPA translations

ltl2dpa:
  stage: test
  variables:
    TEST_NAME: "ltl2dpa"
  <<: *ltlcross_template

ltl2dpa Breakpoint:
  stage: test
  variables:
    TEST_NAME: "ltl2dpa-bp"
  <<: *ltlcross_template

# LTL to D*A translations

ltl2da:
  stage: test
  variables:
    TEST_NAME: "ltl2da"
  <<: *ltlcross_template

# LTL to DELA translations

delag Strict:
  stage: test
  variables:
    TEST_NAME: "delag-strict"
  <<: *ltlcross_template

delag:
  stage: test
  variables:
    TEST_NAME: "delag"
  <<: *ltlcross_template

# rabinizer

rabinizer:
  stage: test
  variables:
    TEST_NAME: "rabinizer"
  <<: *ltlcross_template

# Benchmarks

bench ltl2ldba:
  variables:
    BENCH_NAME: "ltl2ldba"
  <<: *benchmark_template

bench delag:
  variables:
    BENCH_NAME: "delag"
  <<: *benchmark_template

bench ltl2dpa:
  variables:
    BENCH_NAME: "ltl2dpa"
  <<: *benchmark_template

bench ltl2da:
  variables:
    BENCH_NAME: "ltl2da"
  <<: *benchmark_template

bench ltl2dpa Parallel:
  variables:
    BENCH_NAME: "ltl2dpa-parallel"
  <<: *benchmark_template

bench ltl2da Parallel:
  variables:
    BENCH_NAME: "ltl2da-parallel"
  <<: *benchmark_template